# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Cellframe Node

## üìÖ –î–∞—Ç–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è: 14.10.2025

## üéØ –¶–µ–ª—å
–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –≤ —Å–∏—Å—Ç–µ–º–µ QA —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –≤ —Ö–æ–¥–µ –∞–Ω–∞–ª–∏–∑–∞:
- –õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –≤ —Å–µ—Ç–µ–≤—ã—Ö —Ç–µ—Å—Ç–∞—Ö
- –ù–µ–∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤
- Hardcoded –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –°–ª–∞–±—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

## ‚úÖ –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. **–ó–∞–º–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —Ç–µ—Å—Ç–æ–≤**
- **–§–∞–π–ª:** `test_cellframe_qa.py`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –∏–∑ `test_cellframe_qa_fixed.py`
- **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è:** `test_cellframe_qa_old.py`

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–Ω–æ–µ):
assert "net: Backbone" in stdout, "Backbone not in output"
assert mem_mb < 500, f"High memory usage: {mem_mb} MB"

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ):
assert code == 0, f"Network command failed: {stderr}"
assert "error" not in stdout.lower(), "Network error detected"
assert mem_mb < memory_limit_mb, f"Excessive memory usage: {mem_mb} MB"
```

### 2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ø—É—Ç–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**
- **–§–∞–π–ª:** `qa_config.env` (–Ω–æ–≤—ã–π)
- **–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å hardcoded –∑–Ω–∞—á–µ–Ω–∏—è

```bash
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
export CELLFRAME_NODE_DIR="${CELLFRAME_NODE_DIR:-/opt/cellframe-node}"
export QA_MEMORY_LIMIT_MB="${QA_MEMORY_LIMIT_MB:-1024}"
export QA_STRICT_MODE="${QA_STRICT_MODE:-true}"
```

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Dockerfile**
- **–§–∞–π–ª:** `Dockerfile.qa-pytest`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```dockerfile
# –î–æ–±–∞–≤–ª–µ–Ω–æ:
ENV CELLFRAME_NODE_DIR=/opt/cellframe-node
echo "CELLFRAME_NODE_DIR=${CELLFRAME_NODE_DIR}" >> environment.properties
```

### 4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Launch Manager**
- **–§–∞–π–ª:** `launch_manager.sh`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ `qa_config.env`

```bash
# –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –Ω–∞—á–∞–ª–æ:
if [[ -f "qa_config.env" ]]; then
    source qa_config.env
    echo "‚úÖ Loaded QA configuration from qa_config.env"
fi
```

### 5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ GitLab CI**
- **–§–∞–π–ª:** `.gitlab-ci.yml`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:** 
  - –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ–≥ `fixed-tests` –≤ `ALLURE_LAUNCH_TAGS`
  - –û–±–Ω–æ–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ "FIXED QA testing"
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ QA –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 6. **–°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**
- **–§–∞–π–ª:** `test_fixes.sh` (–Ω–æ–≤—ã–π)
- **–¶–µ–ª—å:** –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

---

## üîç –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 1: –õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è —Å–µ—Ç–µ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
**–ë—ã–ª–æ:** –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏–ª –ø—Ä–∏ –≤—ã–≤–æ–¥–µ "Error: failed\nnet: Backbone"
**–°—Ç–∞–ª–æ:** –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –≤ –≤—ã–≤–æ–¥–µ

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ–∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã –ø–∞–º—è—Ç–∏
**–ë—ã–ª–æ:** –õ–∏–º–∏—Ç 500MB (—Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π)
**–°—Ç–∞–ª–æ:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ª–∏–º–∏—Ç 1024MB –∏–ª–∏ 15% –æ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–π –ø–∞–º—è—Ç–∏

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 3: Hardcoded –ø—É—Ç–∏
**–ë—ã–ª–æ:** `/opt/cellframe-node` –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω
**–°—Ç–∞–ª–æ:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `CELLFRAME_NODE_DIR`

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 4: –°–ª–∞–±—ã–π –ø–æ–∏—Å–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
**–ë—ã–ª–æ:** –¢–æ–ª—å–∫–æ `critical|fatal`
**–°—Ç–∞–ª–æ:** 12+ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤–∫–ª—é—á–∞—è `segfault`, `panic`, `assertion failed`

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 5: Race conditions
**–ë—ã–ª–æ:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ `sleep(30)`
**–°—Ç–∞–ª–æ:** –ê–∫—Ç–∏–≤–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

```bash
./test_fixes.sh
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `check_network_ready`: –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏
- ‚úÖ –õ–∏–º–∏—Ç—ã –ø–∞–º—è—Ç–∏: 1024MB (–∞–¥–µ–∫–≤–∞—Ç–Ω–æ)
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ `qa_config.env`
- ‚úÖ TestOps –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: –†–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã: –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

---

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **–†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** - —Ç–µ—Å—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞–¥–∞—é—Ç –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
2. **–ê–¥–µ–∫–≤–∞—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã** - –Ω–µ –±—É–¥–µ—Ç –ª–æ–∂–Ω—ã—Ö –ø–∞–¥–µ–Ω–∏–π –Ω–∞ –∑–¥–æ—Ä–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
3. **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
4. **–°—Ç—Ä–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** - –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

### üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

1. **–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   ```bash
   source qa_config.env
   pytest test_cellframe_qa.py --alluredir=allure-results -v
   ```

2. **–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
   ```bash
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å qa_config.env –ø–æ–¥ –≤–∞—à–∏ –Ω—É–∂–¥—ã
   export CELLFRAME_NODE_DIR="/custom/path"
   export QA_MEMORY_LIMIT_MB="2048"
   ```

3. **–î–ª—è CI/CD:**
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `.gitlab-ci.yml`
   - Launches –±—É–¥—É—Ç –ø–æ–º–µ—á–µ–Ω—ã —Ç–µ–≥–æ–º `fixed-tests`

---

## üîÑ –û–¢–ö–ê–¢ (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)

–î–ª—è –æ—Ç–∫–∞—Ç–∞ –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏:
```bash
cp test_cellframe_qa_old.py test_cellframe_qa.py
cp Dockerfile.qa-pytest.old Dockerfile.qa-pytest
# –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å qa_config.env –∏–∑ launch_manager.sh
# –£–±—Ä–∞—Ç—å QA –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .gitlab-ci.yml
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `./test_fixes.sh` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `qa_config.env`
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `CELLFRAME_NODE_DIR` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

---

*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã: 14.10.2025 22:25*  
*–°—Ç–∞—Ç—É—Å: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é*

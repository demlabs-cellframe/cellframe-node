# üîç –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—Ç–ª–∞–¥–∫–µ –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—é CellFrame DAP SDK

–≠—Ç–æ –≤—Å–µ–æ–±—ä–µ–º–ª—é—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—Ç–ª–∞–¥–∫–µ, –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CellFrame DAP SDK.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –≤ –æ—Ç–ª–∞–¥–∫–µ](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-–≤-–æ—Ç–ª–∞–¥–∫–µ)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Å—Ä–µ–¥—ã-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- [–û—Ç–ª–∞–¥–∫–∞ —Å GDB](#–æ—Ç–ª–∞–¥–∫–∞-—Å-gdb)
- [–°–∞–Ω–∏—Ç–∞–π–∑–µ—Ä—ã –ø–∞–º—è—Ç–∏](#—Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä—ã-–ø–∞–º—è—Ç–∏)
- [–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#–ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- [–ê–Ω–∞–ª–∏–∑ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏](#–∞–Ω–∞–ª–∏–∑-–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è-–ø–∞–º—è—Ç–∏)
- [–û—Ç–ª–∞–¥–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º](#–æ—Ç–ª–∞–¥–∫–∞-—Å–µ—Ç–µ–≤—ã—Ö-–ø—Ä–æ–±–ª–µ–º)
- [–î–µ–±–∞–≥ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π](#–¥–µ–±–∞–≥-–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)
- [–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞](#–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞)
- [–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞](#–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã-–∞–Ω–∞–ª–∏–∑–∞-–∫–æ–¥–∞)
- [–û—Ç–ª–∞–¥–∫–∞ –≤ production](#–æ—Ç–ª–∞–¥–∫–∞-–≤-production)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –≤ –æ—Ç–ª–∞–¥–∫–µ

### 1. –°–±–æ—Ä–∫–∞ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ debug —Å–±–æ—Ä–∫–∏
mkdir build_debug && cd build_debug
cmake .. -DCMAKE_BUILD_TYPE=Debug \
         -DDAP_BUILD_TESTS=ON \
         -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
make -j$(nproc)
```

### 2. –ó–∞–ø—É—Å–∫ —Å –±–∞–∑–æ–≤–æ–π –æ—Ç–ª–∞–¥–∫–æ–π

```bash
# –ó–∞–ø—É—Å–∫ —Å gdb
gdb --args ./my_app --debug

# –í gdb
(gdb) break main
(gdb) run
(gdb) print "Application started"
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

```c
// –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ main()
#ifdef DEBUG
    printf("üêõ Debug mode enabled\n");
    printf("üìç PID: %d\n", getpid());
    printf("üìÇ CWD: %s\n", getcwd(NULL, 0));
#endif
```

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –æ—Ç–ª–∞–¥–∫–∏

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y gdb valgrind kcachegrind \
                   perf-tools-unstable \
                   clang-tools \
                   cppcheck \
                   flawfinder \
                   strace \
                   ltrace

# macOS
brew install gdb valgrind llvm \
             perf gperftools \
             cppcheck flawfinder

# –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
sudo apt install -y lcov gcovr
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CMake –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```cmake
# –í CMakeLists.txt –¥–æ–±–∞–≤—å—Ç–µ:
option(ENABLE_DEBUG "Enable debug build" OFF)
option(ENABLE_ASAN "Enable Address Sanitizer" OFF)
option(ENABLE_TSAN "Enable Thread Sanitizer" OFF)
option(ENABLE_UBSAN "Enable Undefined Behavior Sanitizer" OFF)

if(ENABLE_DEBUG)
    set(CMAKE_BUILD_TYPE Debug)
    add_definitions(-DDEBUG)
    set(CMAKE_EXPORT_COMPILE_COMMANDS ON)
endif()

if(ENABLE_ASAN)
    set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fsanitize=address -fno-omit-frame-pointer")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fsanitize=address -fno-omit-frame-pointer")
endif()

if(ENABLE_TSAN)
    set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fsanitize=thread")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fsanitize=thread")
endif()

if(ENABLE_UBSAN)
    set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fsanitize=undefined")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fsanitize=undefined")
endif()
```

### –°–±–æ—Ä–∫–∞ —Å –æ—Ç–ª–∞–¥–∫–æ–π

```bash
# –°–±–æ—Ä–∫–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏
mkdir build_asan && cd build_asan
cmake .. -DENABLE_DEBUG=ON -DENABLE_ASAN=ON
make -j$(nproc)

# –ò–ª–∏ –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏
mkdir build_tsan && cd build_tsan
cmake .. -DENABLE_DEBUG=ON -DENABLE_TSAN=ON
make -j$(nproc)
```

## üêõ –û—Ç–ª–∞–¥–∫–∞ —Å GDB

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã GDB

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
gdb ./my_app
gdb --args ./my_app arg1 arg2

# –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤–Ω—É—Ç—Ä–∏ gdb
(gdb) break main                    # –¢–æ—á–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∞ –Ω–∞ main
(gdb) break my_function             # –¢–æ—á–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∞ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏
(gdb) break my_file.c:42           # –¢–æ—á–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∞ –Ω–∞ —Å—Ç—Ä–æ–∫–µ
(gdb) run                          # –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
(gdb) continue                     # –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
(gdb) next                         # –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–æ–∫–∞ (–±–µ–∑ –≤—Ö–æ–¥–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏)
(gdb) step                         # –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–æ–∫–∞ (—Å –≤—Ö–æ–¥–æ–º –≤ —Ñ—É–Ω–∫—Ü–∏–∏)
(gdb) finish                       # –í—ã—Ö–æ–¥ –∏–∑ —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏
(gdb) print variable               # –í—ã–≤–æ–¥ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
(gdb) print *pointer               # –†–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª—è
(gdb) backtrace                    # –°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
(gdb) frame N                      # –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–∞–¥—Ä—É —Å—Ç–µ–∫–∞
(gdb) info locals                  # –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
(gdb) info args                    # –ê—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

```bash
# –£—Å–ª–æ–≤–Ω—ã–µ —Ç–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞
(gdb) break my_function if x > 10

# –¢–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏
(gdb) break my_function
(gdb) commands
    printf "Function called with arg: %d\n", arg
    continue
end

# Watchpoints - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
(gdb) watch my_variable
(gdb) rwatch my_variable    # –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ
(gdb) awatch my_variable    # –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
(gdb) handle SIGSEGV stop   # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –Ω–∞ segmentation fault
(gdb) handle SIGPIPE nostop # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å broken pipe

# –†–∞–±–æ—Ç–∞ —Å –ø–æ—Ç–æ–∫–∞–º–∏
(gdb) info threads          # –°–ø–∏—Å–æ–∫ –ø–æ—Ç–æ–∫–æ–≤
(gdb) thread 2              # –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ç–æ–∫ 2
(gdb) thread apply all bt   # –°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤ –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤
```

### –û—Ç–ª–∞–¥–∫–∞ DAP SDK –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```bash
# –û—Ç–ª–∞–¥–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ SDK
(gdb) break dap_common_init
(gdb) run

# –û—Ç–ª–∞–¥–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
(gdb) break dap_client_connect
(gdb) break dap_stream_ch_packet_write

# –û—Ç–ª–∞–¥–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é
(gdb) break malloc
(gdb) break free
```

### –°–∫—Ä–∏–ø—Ç—ã GDB

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.gdbinit` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:

```gdb
# .gdbinit
set pagination off
set print pretty on
set print array on
set print array-indexes on

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤
set auto-load safe-path /

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
define dap_debug
    printf "=== DAP SDK Debug Info ===\n"
    print dap_common_initialized
    print g_dap_log_level
end

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞ –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
break abort
break exit
catch throw
```

## üß† –°–∞–Ω–∏—Ç–∞–π–∑–µ—Ä—ã –ø–∞–º—è—Ç–∏

### Address Sanitizer (ASan)

```bash
# –°–±–æ—Ä–∫–∞ —Å ASan
mkdir build_asan && cd build_asan
cmake .. -DENABLE_DEBUG=ON -DENABLE_ASAN=ON
make

# –ó–∞–ø—É—Å–∫ —Å ASan
./my_app

# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ ASan:
# =================================================================
# ==12345==ERROR: AddressSanitizer: heap-buffer-overflow
# WRITE of size 4 at 0x7f8b0c05a014
#     #0 0x55c5e8b4c2a1 in my_function (/path/to/my_app+0x12a1)
#     #1 0x55c5e8b4c345 in main (/path/to/my_app+0x1345)
# =================================================================
```

### Thread Sanitizer (TSan)

```bash
# –°–±–æ—Ä–∫–∞ —Å TSan
mkdir build_tsan && cd build_tsan
cmake .. -DENABLE_DEBUG=ON -DENABLE_TSAN=ON
make

# –ó–∞–ø—É—Å–∫ —Å TSan
./my_app

# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ TSan:
# ==================
# WARNING: ThreadSanitizer: data race
#   Write of size 8 at 0x7f8b0c05a000 by thread T1:
#     #0 my_write_function (/path/to/my_app+0x12a1)
#   Previous read of size 8 at 0x7f8b0c05a000 by thread T2:
#     #0 my_read_function (/path/to/my_app+0x1345)
# ==================
```

### Undefined Behavior Sanitizer (UBSan)

```bash
# –°–±–æ—Ä–∫–∞ —Å UBSan
mkdir build_ubsan && cd build_ubsan
cmake .. -DENABLE_DEBUG=ON -DENABLE_UBSAN=ON
make

# –ó–∞–ø—É—Å–∫ —Å UBSan
./my_app

# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ UBSan:
# runtime error: signed integer overflow: 2147483647 + 1 cannot be represented in type 'int'
```

### Leak Sanitizer (LSan)

```bash
# –°–±–æ—Ä–∫–∞ —Å LSan (–≤–∫–ª—é—á–µ–Ω –≤ ASan)
mkdir build_lsan && cd build_lsan
cmake .. -DENABLE_DEBUG=ON -DENABLE_ASAN=ON
make

# –ó–∞–ø—É—Å–∫ —Å LSan
LSAN_OPTIONS=suppressions=lsan_suppressions.txt ./my_app

# –§–∞–π–ª lsan_suppressions.txt
# leak:libdap.so
# leak:*alloc
```

## üìä –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Perf - —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫

```bash
# –ó–∞–ø–∏—Å—å –ø—Ä–æ—Ñ–∏–ª—è
perf record -g ./my_app

# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
perf report

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ–±—ã—Ç–∏—è–º
perf stat ./my_app

# –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
perf trace ./my_app

# –ê–Ω–∞–ª–∏–∑ –∫—ç—à–∞
perf stat -e cache-misses ./my_app
```

### Callgrind - –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π

```bash
# –ó–∞–ø—É—Å–∫ —Å callgrind
valgrind --tool=callgrind ./my_app

# –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
callgrind_annotate callgrind.out.*

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç kcachegrind)
kcachegrind callgrind.out.*
```

### Massif - –∞–Ω–∞–ª–∏–∑ –∫—É—á–∏

```bash
# –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—É—á–∏
valgrind --tool=massif ./my_app

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
ms_print massif.out.*
```

### –ë–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥ DAP SDK

```c
// benchmark_dap.h
#pragma once

#include "dap_time.h"

// –ü—Ä–æ—Å—Ç–æ–π –±–µ–Ω—á–º–∞—Ä–∫
#define BENCHMARK_START(name) \
    dap_nanotime_t name##_start = dap_nanotime_now()

#define BENCHMARK_END(name) \
    do { \
        dap_nanotime_t name##_end = dap_nanotime_now(); \
        double name##_elapsed = (name##_end - name##_start) / 1000000.0; \
        printf("BENCHMARK %s: %.3f ms\n", #name, name##_elapsed); \
    } while(0)

// –î–µ—Ç–∞–ª—å–Ω—ã–π –±–µ–Ω—á–º–∞—Ä–∫
typedef struct benchmark_result {
    const char *name;
    double min_time;
    double max_time;
    double avg_time;
    size_t iterations;
} benchmark_result_t;

benchmark_result_t *benchmark_run(const char *name,
                                 void (*func)(void),
                                 size_t iterations);
```

## üßµ –î–µ–±–∞–≥ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### –û—Ç–ª–∞–¥–∫–∞ race conditions

```c
// –î–æ–±–∞–≤—å—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –º–µ—Ç–∫–∏
static pthread_mutex_t debug_mutex = PTHREAD_MUTEX_INITIALIZER;
static __thread int thread_id = 0;

void debug_thread_enter(const char *func_name) {
    pthread_mutex_lock(&debug_mutex);
    printf("Thread %d entering %s\n", thread_id, func_name);
    pthread_mutex_unlock(&debug_mutex);
}

void debug_thread_exit(const char *func_name) {
    pthread_mutex_lock(&debug_mutex);
    printf("Thread %d exiting %s\n", thread_id, func_name);
    pthread_mutex_unlock(&debug_mutex);
}
```

### Helgrind - –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ race conditions

```bash
# –ó–∞–ø—É—Å–∫ —Å helgrind
valgrind --tool=helgrind ./my_app

# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
# ==12345== ----------------------------------------------------------------
# ==12345== Possible data race during read of size 4 at 0x7f8b0c05a000
# ==12345== by thread #1
# ==12345== by thread #2
# ==12345== ----------------------------------------------------------------
```

### –û—Ç–ª–∞–¥–∫–∞ deadlock'–æ–≤

```c
// –î–µ—Ç–µ–∫—Ç–æ—Ä deadlock'–æ–≤
static pthread_mutex_t mutex1 = PTHREAD_MUTEX_INITIALIZER;
static pthread_mutex_t mutex2 = PTHREAD_MUTEX_INITIALIZER;

void safe_lock_debug(pthread_mutex_t *mutex, const char *name) {
    printf("Thread %ld trying to lock %s\n", pthread_self(), name);
    int result = pthread_mutex_lock(mutex);
    if (result == 0) {
        printf("Thread %ld locked %s\n", pthread_self(), name);
    } else {
        printf("Thread %ld failed to lock %s: %s\n",
               pthread_self(), name, strerror(result));
    }
}
```

## üåê –û—Ç–ª–∞–¥–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º

### Wireshark –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–∞—Ñ–∏–∫–∞

```bash
# –ó–∞—Ö–≤–∞—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
sudo wireshark

# –§–∏–ª—å—Ç—Ä—ã –¥–ª—è DAP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
# tcp port 8081
# http contains "cellframe"

# –ó–∞—Ö–≤–∞—Ç –≤ —Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
tcpdump -i eth0 -w capture.pcap tcp port 8081
```

### –û—Ç–ª–∞–¥–∫–∞ HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

```bash
# –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —Å–µ—Ç–∏
strace -e trace=network ./my_app

# –û—Ç–ª–∞–¥–∫–∞ DNS
strace -e trace=getaddrinfo ./my_app

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
netstat -tlnp | grep :8081
ss -tlnp | grep :8081
```

### DAP SDK —Å–µ—Ç–µ–≤–æ–π –¥–µ–±–∞–≥

```c
// –í–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–µ–±–∞–≥–∞
extern int g_dap_net_debug_more;
g_dap_net_debug_more = 1;

// –û—Ç–ª–∞–¥–∫–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
dap_client_debug_enable(true);

// –û—Ç–ª–∞–¥–∫–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
dap_server_debug_enable(true);
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è DAP SDK

```c
// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
dap_log_set_level(L_DEBUG);

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—Ä–æ–≤–Ω—è–º–∏
DAP_LOG_DEBUG("Debug message: %s", debug_info);
DAP_LOG_INFO("Info message: %d", value);
DAP_LOG_WARNING("Warning message");
DAP_LOG_ERROR("Error message: %s", error_str);
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–æ—á–Ω–æ–≥–æ –ª–æ–≥–∞

```c
// –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π
#define TRACE_ENTER() \
    DAP_LOG_DEBUG("ENTER: %s:%d %s", __FILE__, __LINE__, __FUNCTION__)

#define TRACE_EXIT() \
    DAP_LOG_DEBUG("EXIT: %s:%d %s", __FILE__, __LINE__, __FUNCTION__)

void my_function() {
    TRACE_ENTER();

    // –ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏

    TRACE_EXIT();
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```c
// JSON –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
typedef struct log_entry {
    const char *timestamp;
    const char *level;
    const char *component;
    const char *message;
    const char *function;
    int line;
    const char *thread_id;
} log_entry_t;

void log_structured(log_entry_t *entry) {
    printf("{\"timestamp\":\"%s\",\"level\":\"%s\",\"component\":\"%s\","
           "\"message\":\"%s\",\"function\":\"%s\",\"line\":%d,"
           "\"thread_id\":\"%s\"}\n",
           entry->timestamp, entry->level, entry->component,
           entry->message, entry->function, entry->line,
           entry->thread_id);
}
```

## üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞

### Cppcheck - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

```bash
# –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
cppcheck --enable=all --std=c99 src/

# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
cppcheck --enable=all --std=c99 --suppress=unusedFunction src/

# –ê–Ω–∞–ª–∏–∑ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ MISRA C
cppcheck --enable=all --std=c99 --addon=misra_c_2012 src/

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è XML –æ—Ç—á–µ—Ç–∞
cppcheck --enable=all --std=c99 --xml src/ 2> cppcheck_results.xml
```

### Flawfinder - –ø–æ–∏—Å–∫ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

```bash
# –ü–æ–∏—Å–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
flawfinder src/

# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
flawfinder -D -c src/

# –° —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
flawfinder --inputs src/  # –§–æ–∫—É—Å –Ω–∞ input —Ñ—É–Ω–∫—Ü–∏—è—Ö
```

### Clang Static Analyzer

```bash
# –ê–Ω–∞–ª–∏–∑ —Å clang
scan-build make

# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
scan-build -v make

# –° –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —á–µ–∫–µ—Ä–∞–º–∏
scan-build --use-analyzer=/usr/bin/clang make
```

### Coverage –∞–Ω–∞–ª–∏–∑

```bash
# –°–±–æ—Ä–∫–∞ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
mkdir build_coverage && cd build_coverage
cmake .. -DCMAKE_BUILD_TYPE=Debug -DENABLE_COVERAGE=ON
make

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
lcov --capture --directory . --output-file coverage.info
genhtml coverage.info --output-directory coverage_report

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
firefox coverage_report/index.html
```

## üöÄ –û—Ç–ª–∞–¥–∫–∞ –≤ production

### Core dumps

```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ core dumps
ulimit -c unlimited

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É—Ç–∏ –¥–ª—è core dumps
echo "core.%e.%p.%t" > /proc/sys/kernel/core_pattern

# –ê–Ω–∞–ª–∏–∑ core dump
gdb ./my_app core.my_app.1234.1640995200

# –í gdb
(gdb) bt           # –°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
(gdb) info threads # –ü–æ—Ç–æ–∫–∏
(gdb) print var    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```

### Remote debugging

```bash
# –ù–∞ production —Å–µ—Ä–≤–µ—Ä–µ
gdbserver :9090 ./my_app

# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
gdb ./my_app
(gdb) target remote production-server:9090
(gdb) continue
```

### Logging –≤ production

```c
// Production-ready –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
typedef struct prod_logger {
    FILE *log_file;
    pthread_mutex_t mutex;
    bool async_mode;
    int max_file_size;
    int max_files;
} prod_logger_t;

// –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è production
void prod_log_async(prod_logger_t *logger, const char *level,
                   const char *format, ...) {
    // –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å
    va_list args;
    va_start(args, format);

    char *buffer = malloc(4096);
    vsnprintf(buffer, 4096, format, args);

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏
    log_queue_add(logger, level, buffer);

    va_end(args);
}
```

### Monitoring –∏ alerting

```c
// Health check endpoints
void health_check_handler(dap_http_client_t *client, void *arg) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    bool db_ok = check_database_connection();
    bool network_ok = check_network_connectivity();
    bool memory_ok = check_memory_usage();

    if (db_ok && network_ok && memory_ok) {
        client->out_status = 200;
        client->out_body = (uint8_t *)strdup("OK");
    } else {
        client->out_status = 503;
        client->out_body = (uint8_t *)strdup("Service Unavailable");
    }
}

// Metrics collection
typedef struct app_metrics {
    uint64_t requests_total;
    uint64_t requests_failed;
    uint64_t response_time_sum;
    uint64_t active_connections;
    // ... –¥—Ä—É–≥–∏–µ –º–µ—Ç—Ä–∏–∫–∏
} app_metrics_t;

// –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –≤ Prometheus —Ñ–æ—Ä–º–∞—Ç–µ
void export_prometheus_metrics(app_metrics_t *metrics) {
    printf("# HELP requests_total Total number of requests\n");
    printf("# TYPE requests_total counter\n");
    printf("requests_total %llu\n", metrics->requests_total);

    printf("# HELP response_time_avg Average response time\n");
    printf("# TYPE response_time_avg gauge\n");
    printf("response_time_avg %.2f\n",
           (double)metrics->response_time_sum / metrics->requests_total);
}
```

## üêõ –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: Segmentation Fault

```bash
# –ê–Ω–∞–ª–∏–∑ —Å valgrind
valgrind --tool=memcheck --leak-check=full ./my_app

# –û—Ç–ª–∞–¥–∫–∞ —Å gdb
gdb ./my_app
(gdb) run
(gdb) bt  # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
```

### –ü—Ä–æ–±–ª–µ–º–∞: Memory Leaks

```bash
# –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫
valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all ./my_app

# –¢—Ä–µ–∫–∏–Ω–≥ –∞–ª–ª–æ–∫–∞—Ü–∏–π
valgrind --tool=massif ./my_app
ms_print massif.out.*
```

### –ü—Ä–æ–±–ª–µ–º–∞: Deadlocks

```bash
# –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ deadlock'–æ–≤
valgrind --tool=helgrind ./my_app

# –ê–Ω–∞–ª–∏–∑ —Å gdb
gdb ./my_app
(gdb) info threads
(gdb) thread apply all bt
```

### –ü—Ä–æ–±–ª–µ–º–∞: Performance Degradation

```bash
# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ CPU
perf record -g ./my_app
perf report

# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
valgrind --tool=massif ./my_app

# –°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
vmstat 1
iostat 1
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [GDB Manual](https://sourceware.org/gdb/current/onlinedocs/gdb/)
- [Valgrind Manual](https://valgrind.org/docs/manual/manual.html)
- [Perf Manual](https://perf.wiki.kernel.org/index.php/Main_Page)

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- [Cppcheck](http://cppcheck.sourceforge.net/)
- [Flawfinder](https://dwheeler.com/flawfinder/)
- [Clang Static Analyzer](https://clang-analyzer.llvm.org/)

### –°–æ–æ–±—â–µ—Å—Ç–≤–æ
- [Stack Overflow - C Debugging](https://stackoverflow.com/questions/tagged/c+debugging)
- [Reddit - C Programming](https://www.reddit.com/r/C_Programming/)

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ—Ç–ª–∞–¥–∫–∏

### 1. –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞
```c
// –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
int result = some_function();
if (result != SUCCESS) {
    DAP_LOG_ERROR("Function failed: %d", result);
    return result;
}

// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ assert –≤ debug —Å–±–æ—Ä–∫–∞—Ö
assert(ptr != NULL);
assert(value >= 0);
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```c
// –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Ö–æ–¥—ã/–≤—ã—Ö–æ–¥—ã —Ñ—É–Ω–∫—Ü–∏–π
DAP_LOG_DEBUG("Enter function: param=%d", param);

// –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤–∞–∂–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
DAP_LOG_INFO("Processing %zu items", item_count);

// –õ–æ–≥–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
DAP_LOG_ERROR("Database connection failed: %s (errno=%d)",
              strerror(errno), errno);
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```c
// Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
void test_my_function() {
    // Arrange
    int input = 42;
    int expected = 84;

    // Act
    int result = my_function(input);

    // Assert
    dap_assert(result == expected, "Function should double input");
}
```

### 4. CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```yaml
# .github/workflows/debug.yml
name: Debug Build
on: [push, pull_request]

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Setup
      run: sudo apt install -y valgrind cppcheck
    - name: Build Debug
      run: |
        mkdir build && cd build
        cmake .. -DENABLE_DEBUG=ON -DENABLE_ASAN=ON
        make -j$(nproc)
    - name: Run Tests with Sanitizers
      run: |
        cd build
        ctest --output-on-failure
    - name: Static Analysis
      run: cppcheck --enable=all --std=c99 src/
```

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ - –∫–ª—é—á –∫ —Å–æ–∑–¥–∞–Ω–∏—é –Ω–∞–¥–µ–∂–Ω—ã—Ö –∏ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ CellFrame DAP SDK. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ —Å–ª–µ–¥—É–π—Ç–µ –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–∞–∏–ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

**üêõ –ü–æ–º–Ω–∏—Ç–µ:** "–õ—É—á—à–∏–π —Å–ø–æ—Å–æ–± –Ω–∞–π—Ç–∏ –±–∞–≥ - —ç—Ç–æ –∏–º–µ—Ç—å —Ö–æ—Ä–æ—à—É—é —Å–∏—Å—Ç–µ–º—É –æ—Ç–ª–∞–¥–∫–∏!"

**üìû –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?** –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ [—Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É](https://cellframe.net/support) –∏–ª–∏ –Ω–∞—à–µ [—Å–æ–æ–±—â–µ—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤](https://t.me/cellframe_dev).

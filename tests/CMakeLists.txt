# tests/CMakeLists.txt
cmake_minimum_required(VERSION 3.16)
project(cellframe_tests LANGUAGES C CXX)

enable_testing()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ¥‡  ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° â„–1 â€• ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ GoogleTest
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
find_package(GTest QUIET CONFIG)     # Ğ¸Ñ‰ĞµÑ‚ GTest::gtest Ğ¸ GTest::gtest_main
set(GTEST_OK FALSE)

if (GTest_FOUND)
    # ĞĞ° Debian/Ubuntu Ğ½ÑƒĞ¶Ğ½Ğ¾ ÑĞ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ,
    # Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ Ğ¿Ğ°ĞºĞµÑ‚ ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ğ¸ĞºĞ¸:
    #   sudo apt-get install --yes libgtest-dev && \
    #   cd /usr/src/gtest && sudo cmake -DBUILD_SHARED_LIBS=ON . && \
    #   sudo make -j$(nproc) && sudo cp *.so /usr/lib
    #
    # ĞĞ¾ Ğ² Docker-Ğ¾Ğ±Ñ€Ğ°Ğ·Ğµ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ²Ñ‹ ÑƒĞ¶Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚Ğµ, Ğ¼Ñ‹ Ğ¼Ğ¾Ğ¶ĞµĞ¼
    # ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ ÑÑ‚Ğ¾ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ğ¼Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼Ğ¸ (ÑĞ¼. .gitlab-ci.yml).
    #
    message(STATUS "Use system GTest found at ${GTEST_ROOT}")
    set(GTEST_OK TRUE)
else()
    message(STATUS "System GTest **NOT** found â€” fall back to vendored copy")
endif()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ¥ˆ  ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° â„–2 â€• Ğ²ĞµĞ½Ğ´Ğ¾Ñ€Ğ½Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if (NOT GTEST_OK)
    # third_party/googletest               â† clone Ğ¸Ğ»Ğ¸ submodule
    add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/../third_party/googletest
                     ${CMAKE_BINARY_DIR}/_gtest_build
                     EXCLUDE_FROM_ALL)

    # Ğ’Ğ½ÑƒÑ‚Ñ€Ğ¸ googletest ÑƒĞ¶Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ÑÑ target gtest Ğ¸ gtest_main
    # Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸Ğ¼ĞµĞ½Ğ° Ñ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ°Ğ¼Ğ¸ find_package()
    add_library(GTest::gtest       ALIAS gtest)
    add_library(GTest::gtest_main  ALIAS gtest_main)
endif()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#  ĞŸÑƒÑ‚ÑŒ Ğº Cellframe-SDK
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
set(DAP_ROOT         ${CMAKE_SOURCE_DIR})                      # ĞºĞ¾Ñ€ĞµĞ½ÑŒ cellframe-node
set(DAP_CORE_INC     ${DAP_ROOT}/dap-sdk/core/include)
set(DAP_CRYPTO_INC   ${DAP_ROOT}/dap-sdk/crypto/include)
set(DAP_XKCP_INC
    ${DAP_ROOT}/dap-sdk/crypto/external/xkcp/Standalone
    ${DAP_ROOT}/dap-sdk/crypto/external/xkcp/Standalone/CompactFIPS202
    ${DAP_ROOT}/dap-sdk/crypto/external/xkcp/Keccak)

include_directories(
    ${DAP_CORE_INC}
    ${DAP_CRYPTO_INC}
    ${DAP_XKCP_INC}
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#  Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ ÑƒĞ¶Ğµ ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… .so Ğ¸Ğ· Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ±Ğ¸Ğ»Ğ´Ğ°
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
find_library(DAP_CORE_LIB
             NAMES dap dap-core
             PATHS ${DAP_ROOT}/build/lib NO_DEFAULT_PATH REQUIRED)

find_library(DAP_CRYPTO_LIB
             NAMES dap_crypto dap-crypto
             PATHS ${DAP_ROOT}/build/lib NO_DEFAULT_PATH REQUIRED)

if(NOT TARGET dap_core)
    add_library(dap_core SHARED IMPORTED)
    set_target_properties(dap_core PROPERTIES IMPORTED_LOCATION "${DAP_CORE_LIB}")
endif()

if(NOT TARGET dap_crypto)
    add_library(dap_crypto SHARED IMPORTED)
    set_target_properties(dap_crypto PROPERTIES IMPORTED_LOCATION "${DAP_CRYPTO_LIB}")
endif()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#  Ğ¢ĞµÑÑ‚Ñ‹
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
add_executable(test_base58 test_base58.cpp)
target_link_libraries(test_base58
    PRIVATE
        GTest::gtest_main          # Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ñ ÑˆĞ°Ğ³Ğ°Ğ¼ Ğ²Ñ‹ÑˆĞµ
        dap_core
        dap_crypto
)

add_test(NAME base58 COMMAND test_base58)

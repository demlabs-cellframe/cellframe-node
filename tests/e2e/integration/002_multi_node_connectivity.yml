# Test: Multi-Node Connectivity
# Test connectivity between multiple nodes

name: Multi-Node Connectivity Test
description: Test that multiple nodes can connect and stay online
tags: [e2e, integration, network, connectivity]
version: "1.0"

network:
  topology: default

setup:
  - wait: 15s
    description: "Wait for network to establish"

test:
  # Check all nodes are online
  - cli: net -net stagenet get status
    node: node1
    expect: success
    contains: "NET_STATE_ONLINE"
    description: "Node1 is online"
  
  - cli: net -net stagenet get status
    node: node2
    expect: success
    contains: "NET_STATE_ONLINE"
    description: "Node2 is online"
  
  - cli: net -net stagenet get status
    node: node3
    expect: success
    contains: "NET_STATE_ONLINE"
    description: "Node3 is online"

check:
  # Verify links on node1
  - cli: net -net stagenet link list
    node: node1
    expect: success
    save: node1_links
    description: "Get node1 links"
  
  # Verify links on node2
  - cli: net -net stagenet link list
    node: node2
    expect: success
    save: node2_links
    description: "Get node2 links"
  
  # Verify at least some links exist
  - python: |
      links1 = ctx.get_variable('node1_links')
      links2 = ctx.get_variable('node2_links')
      assert links1, "Node1 should have link info"
      assert links2, "Node2 should have link info"
    description: "Nodes have established links"


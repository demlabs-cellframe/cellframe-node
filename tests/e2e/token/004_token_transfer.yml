# Test: Token Transfer
# Verify token transfers between wallets

name: Token Transfer Test
description: Test transferring tokens between two wallets
tags: [e2e, token, transfer]
version: "1.0"

network:
  topology: default

includes:
  - common/networks/single_node.yml

setup:
  - wait: 3s
  
  # Create two wallets
  - cli: wallet new -w wallet1
    node: node1
    expect: success
    wait: 1s
    description: "Create wallet1"
  
  - cli: wallet new -w wallet2
    node: node1
    expect: success
    wait: 1s
    description: "Create wallet2"
  
  # Get wallet addresses
  - cli: wallet info -w wallet1 -net stagenet
    node: node1
    expect: success
    save: wallet1_info
    extract:
      pattern: "addr:\\s+([A-Za-z0-9:]+)"
      group: 1
      variable: wallet1_addr
    description: "Get wallet1 address"
  
  - cli: wallet info -w wallet2 -net stagenet
    node: node1
    expect: success
    save: wallet2_info
    extract:
      pattern: "addr:\\s+([A-Za-z0-9:]+)"
      group: 1
      variable: wallet2_addr
    description: "Get wallet2 address"
  
  # Create and emit token
  - cli: token_decl -net stagenet -token XFERTEST -total 1000000
    node: node1
    expect: success
    wait: 3s
    description: "Create token"
  
  - cli: token_emit -net stagenet -token XFERTEST -value 10000 -addr {{wallet1_addr}}
    node: node1
    expect: success
    save: emit_tx
    wait: 3s
    description: "Emit to wallet1"

test:
  # Test: Transfer tokens to wallet2
  - cli: tx_create -net stagenet -token XFERTEST -from_emission {{emit_tx}} -to_addr {{wallet2_addr}} -value 1000
    node: node1
    expect: success
    save: transfer_tx
    wait: 5s
    description: "Transfer 1000 tokens to wallet2"

check:
  # Verify transaction in history
  - cli: tx_history -net stagenet -tx {{transfer_tx}}
    node: node1
    contains: "{{transfer_tx}}"
    description: "Verify transfer in history"


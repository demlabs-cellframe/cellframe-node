# Common: Create test wallet
# Shared component for creating a test wallet

setup:
  - cli: wallet new -w test_wallet
    node: node1
    expect: success
    save: wallet_created
    wait: 1s
    description: "Create test wallet"
  
  - cli: wallet info -w test_wallet -net stagenet
    node: node1
    expect: success
    save: wallet_info_output
    description: "Get wallet info"
  
  # Extract address using Python (more reliable than extract field)
  - python: |
      import re
      wallet_info = ctx.get_variable('wallet_info_output')
      match = re.search(r'addr:\s+(\S+)', wallet_info)
      assert match, f"Failed to extract address from wallet info"
      wallet_addr = match.group(1)
      ctx.set_variable('wallet_addr', wallet_addr)
    description: "Extract wallet address"

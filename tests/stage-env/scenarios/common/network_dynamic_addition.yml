# Dynamic Node Addition Scenario
# Tests adding new nodes to running network

name: Dynamic Node Addition Test
description: Test adding nodes dynamically to running network through balancer
author: Stage-Env
tags: [network, balancer, dynamic]
version: "1.0"

# Start with minimal network
network:
  topology: default
  nodes:
    - name: node1
      role: root
      validator: true
    
    - name: node2
      role: root
      validator: false
    
    - name: node3
      role: root
      validator: false
    
    - name: node4
      role: master
      validator: true
    
    - name: node5
      role: master
      validator: true
    
    - name: node6
      role: master
      validator: true

# Setup: verify initial network
setup:
  - cli: net list
    node: node1
    save: initial_nets
    contains: "stagenet"
  
  - cli: node list
    node: node1
    save: initial_nodes
  
  - wait: 10s  # Let network stabilize

# Test: Add new full node dynamically
test:
  - cli: net -net stagenet status
    node: node1
    expect: success
    contains: "online"
  
  # Check balancer is working on seed nodes
  - cli: balancer status
    node: node1
    expect: success
    save: balancer_status
  
  # Verify seed nodes are registered
  - cli: node list -net stagenet
    node: node1
    contains: "node1"
    contains: "node2"
    contains: "node3"
  
  # Wait for consensus to stabilize
  - wait: 5s

# Check: Verify network health
check:
  - cli: net -net stagenet status
    node: node1
    contains: "online"
  
  - cli: node list -net stagenet
    node: node1
    contains: "node4"
    contains: "node5"
    contains: "node6"
  
  # Check that balancer provided links to new nodes
  - cli: node links -net stagenet
    node: node6
    expect: success


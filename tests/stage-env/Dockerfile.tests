# Dockerfile for running tests
FROM python:3.9-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    jq \
    netcat \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies (CF20 compatible)
RUN pip install --no-cache-dir \
    requests==2.31.0 \
    pytest==7.4.2 \
    pytest-asyncio==0.21.1 \
    aiohttp==3.8.5 \
    asyncio-mqtt==0.13.0 \
    pyyaml==6.0.1 \
    colorlog==6.7.0 \
    pycryptodome==3.18.0

# Create working directory
WORKDIR /tests

# Copy testing utilities
COPY tests/utils/ ./utils/
COPY tests/requirements.txt ./requirements.txt

# Install additional dependencies from requirements.txt
RUN pip install -r requirements.txt

# Create entry point for tests
COPY tests/run-tests.sh /usr/local/bin/run-tests.sh
RUN chmod +x /usr/local/bin/run-tests.sh

ENTRYPOINT ["/usr/local/bin/run-tests.sh"]

# token_update -utxo_blocked_add Command Test
# Функциональный тест команды добавления UTXO в blocklist

name: token_update -utxo_blocked_add Command
description: Test adding UTXO to token blocklist
tags: [functional, utxo-blocking, token_update, fast]
version: "1.0"

network:
  topology: default

includes:
  - common/networks/single_node.yml
  - common/wallets/create_wallet.yml

setup:
  # Create token with UTXO blocking
  - cli: token_decl -net stagenet -token ADDTEST -total 1000000 -flags UTXO_BLOCKING_ENABLED
    save: token
    wait: 3s
  
  # Emit and create UTXO
  - cli: token_emit -token ADDTEST -value 1000 -addr {{wallet_addr}}
    save: emission
    wait: 3s
  
  - cli: tx_create -token ADDTEST -from_emission {{emission}} -value 500
    save: utxo
    wait: 3s

test:
  # Test: Add UTXO to blocklist
  - cli: token_update -net stagenet -token ADDTEST -utxo_blocked_add {{utxo}}:0
    expect: success
    wait: 3s

check:
  # Verify UTXO is in blocklist
  - cli: token info -net stagenet -token ADDTEST -history_limit 10
    contains: "{{utxo}}"
  
  # Verify UTXO is actually blocked
  - cli: tx_create -token ADDTEST -from {{utxo}}:0 -value 100
    expect: error
    contains: "blocked"


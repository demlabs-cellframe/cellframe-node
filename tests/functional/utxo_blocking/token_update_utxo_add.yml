# token_update -utxo_blocked_add Command Test
# Функциональный тест команды добавления UTXO в blocklist

name: token_update -utxo_blocked_add Command
description: Test adding UTXO to token blocklist
tags: [functional, utxo-blocking, token_update, fast]
version: "1.0"

network:
  topology: default

includes:
  - common/networks/single_node.yml
  - common/wallets/create_wallet.yml

# Global defaults for all sections
defaults:
  node: node1
  wait: 3s

setup:
  # Create token with UTXO blocking
  - cli: token_decl -net stagenet -token ADDTEST -total 1000000 -flags UTXO_BLOCKING_ENABLED
    save: token
    description: "Create ADDTEST token"
  
  # Emit and create UTXO
  - cli: token_emit -net stagenet -token ADDTEST -value 1000 -addr {{wallet_addr}}
    save: emission
    description: "Emit tokens"
  
  - cli: tx_create -net stagenet -token ADDTEST -from_emission {{emission}} -value 500
    save: utxo
    description: "Create UTXO"

test:
  # Test: Add UTXO to blocklist
  - cli: token_update -net stagenet -token ADDTEST -utxo_blocked_add {{utxo}}:0
    description: "Add UTXO to blocklist"

check:
  # Verify UTXO is in blocklist
  - cli: token info -net stagenet -name ADDTEST
    contains: "ADDTEST"
    description: "Verify token info"
  
  # Verify UTXO is actually blocked
  - cli: tx_create -net stagenet -token ADDTEST -from {{utxo}}:0 -value 100
    expect: error
    contains: "blocked"
    description: "Verify UTXO is blocked"


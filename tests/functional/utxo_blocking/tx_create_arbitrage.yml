# tx_create -arbitrage Command Test
# Функциональный тест команды создания арбитражной транзакции

name: tx_create -arbitrage Command
description: Test creating arbitrage transaction with -arbitrage flag
tags: [functional, utxo-blocking, tx_create, arbitrage, fast]
version: "1.0"

network:
  topology: default

includes:
  - common/networks/single_node.yml
  - common/wallets/create_wallet.yml

# Global defaults for all sections
defaults:
  node: node1
  wait: 3s

setup:
  # Get wallet address
  - cli: wallet info -w test_wallet -net stagenet
    save: wallet_info
  
  - python: |
      import re
      wallet_info = ctx.get_variable('wallet_info')
      match = re.search(r'addr:\s+(\S+)', wallet_info)
      assert match, f"Failed to extract address from: {wallet_info}"
      ctx.set_variable('wallet_addr', match.group(1))
  
  # Create token
  - cli: token_decl -net stagenet -token ARBCMD -total 1000000
    save: token
    description: "Create ARBCMD token"
  
  # Emit tokens
  - cli: token_emit -net stagenet -token ARBCMD -value 10000 -addr {{wallet_addr}}
    description: "Emit tokens"

test:
  # Test: Create arbitrage transaction
  - cli: tx_create -net stagenet -token ARBCMD -value 1000 -arbitrage
    save: arb_tx
    description: "Create arbitrage transaction"

check:
  # Verify transaction exists
  - cli: tx_history -net stagenet -tx {{arb_tx}}
    contains: "{{arb_tx}}"
    description: "Verify tx in history"
  
  # Verify arbitrage marker present (if it's in the output)
  - cli: tx_info -net stagenet -tx {{arb_tx}}
    description: "Get tx info"


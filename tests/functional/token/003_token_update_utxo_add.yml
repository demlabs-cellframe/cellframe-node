# token_update -utxo_blocked_add Command Test
# Функциональный тест команды добавления UTXO в blocklist

name: token_update -utxo_blocked_add Command
description: Test adding UTXO to token blocklist
tags: [functional, utxo-blocking, token_update, fast]
version: "1.0"

network:
  topology: default

includes:
  - common/networks/single_node.yml
  - common/wallets/create_wallet.yml

# Global defaults for all sections
defaults:
  node: node1
  wait: 3s

setup:
  # Create token with UTXO blocking
  - cli: token_decl -decimals 18 -signs_total 1 -signs_emission 1 -token ADDTEST -total_supply 1000000 -flags UTXO_BLOCKING_ENABLED -certs test_cert
    save: token
  
  # Emit and create UTXO
  - cli: token_emit -token ADDTEST -value 1000 -addr {{wallet_addr}} -certs test_cert
    save: emission
  
  - wait_for_datum: "{{emission}}"
  
  # Create UTXO
  - cli: tx_create -token ADDTEST -from_emission {{emission}} -value 500 -fee 0.1
    save: utxo
  
  - wait_for_datum: "{{utxo}}"

test:
  # Test: Add UTXO to blocklist
  - cli: token_update -token ADDTEST -utxo_blocked_add {{utxo}}:0

check:
  # Verify UTXO is in blocklist
  - cli: token info -name ADDTEST
    contains: "ADDTEST"
  
  # Verify UTXO is actually blocked - try to use it
  - cli: tx_create -token ADDTEST -from {{utxo}}:0 -to_addr {{wallet_addr}} -value 100 -fee 0.1
    expect: error
    contains: "blocked"

